## [ESXI-80-000239] When attempting to configure Allowed IPs for the ESXi firewall you may see an error for some services
This issue was resolved with the release of the VMware vSphere 8.0 ESXi Security Technical Implementation Guide :: Version 2, Release: 1 Benchmark Date: 01 Aug 2024.  

Related issue: None

You may see the error `Invalid operation requested: Can not change allowed ip list this ruleset, it is owned by system service.` when configuring some services.  

Due to changes in the ESXi firewall some services are unable to be configured to restrict access via a list of IP addresses or ranges. See the [8.0 U2 release notes](https://docs.vmware.com/en/VMware-vSphere/8.0/rn/vsphere-vcenter-server-802-release-notes/index.html#Known%20Issues-Miscellaneous%20Issues) for more information.  

### Workaround
As of 8.0 U2b most services are now once again user configurable for the Allowed IP settings. A future STIG update will clarify that services that are not user configurable are not in scope of the rule. See the below list for what is user configurable. 

```
esxcli network firewall ruleset list

Name                         Enabled  Enable/Disable configurable  Allowed IP configurable
---------------------------  -------  ---------------------------  -----------------------
sshServer                       true                         true                     true
sshClient                      false                         true                     true
nfsClient                      false                        false                    false
nfs41Client                    false                        false                    false
dhcp                            true                        false                     true
dns                             true                         true                     true
snmp                           false                        false                     true
ntpClient                      false                        false                     true
CIMHttpServer                   true                        false                     true
CIMHttpsServer                 false                        false                     true
CIMSLP                         false                        false                     true
iSCSI                          false                        false                     true
vpxHeartbeats                   true                        false                     true
updateManager                   true                         true                     true
faultTolerance                  true                         true                     true
webAccess                       true                         true                     true
vMotion                         true                        false                     true
vSphereClient                   true                         true                     true
activeDirectoryAll             false                        false                     true
NFC                             true                        false                     true
HBR                             true                        false                     true
ftpClient                      false                         true                     true
httpClient                     false                         true                     true
gdbserver                      false                         true                     true
DVFilter                       false                         true                     true
DHCPv6                          true                        false                     true
DVSSync                         true                        false                     true
syslog                         false                         true                     true
WOL                             true                         true                     true
vSPC                           false                         true                     true
remoteSerialPort               false                         true                     true
rdt                             true                        false                     true
cmmds                           true                        false                     true
ipfam                          false                         true                     true
iofiltervp                      true                        false                     true
esxupdate                      false                        false                     true
vsanEncryption                 false                        false                    false
pvrdma                         false                         true                     true
vic-engine                     false                         true                     true
etcdClientComm                  true                        false                     true
etcdPeerComm                    true                        false                     true
settingsd                      false                        false                     true
vdfs                           false                        false                     true
gstored                        false                        false                     true
trusted-infrastructure-kmxd    false                        false                    false
iwarp-pm                       false                         true                     true
ptpd                           false                        false                     true
trusted-infrastructure-kmxa    false                        false                    false
nvmetcp                        false                        false                     true
esxio-orchestrator             false                        false                     true
esxioComm                      false                        false                     true
nvmemdns                       false                        false                     true
proxy                          false                        false                    false
dpd                            false                        false                     true
vltd                           false                        false                     true
vsanhealth-unicasttest         false                        false                     true
vsanmgmt-https-tunnel           true                        false                     true
```

## [ESXI-80-000239] Impact to VxRail Manager Plugin performance and VCF on VxRail add node workflows

Related issue: None

When attempting to add a new host to an existing VxRail cluster the NIC configuration may not load and/or the validation step will fail and the host will not be added. The VxRail plugin in vCenter may also experience delays in loading.

### Workaround

**Option 1:** (Recommended) Do not implement ESXI-80-000239 in these environments until this issue is resolved.  
**Option 2:** To add a node, disable the ESXi firewall on all hosts in the target cluster for the duration of the operation and re-enable once complete.  

If using the `VMware_vSphere_8.0_STIG_ESXi_Remediation.ps1` script provided in this repo to harden ESXi you can disable this rule by changing the variable `ESXI800000239` to `$false` before running. This can be found [here](https://github.com/vmware/dod-compliance-and-automation/blob/master/vsphere/8.0/v1r1-srg/vsphere/powercli/VMware_vSphere_8.0_STIG_ESXi_Remediation.ps1#L254).  
